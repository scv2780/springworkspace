<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.dept.mapper.DeptMapper">
	<!-- 부서 전체조회 -->
		<select id="selectDeptAll" resultType="DeptVO">
			SELECT 	department_id
					,department_name
					,manager_id
					,location_id
			FROM departments
			ORDER BY department_id
		</select>
		
	<!-- 부서 단건조회 -->
		<select id="selectDept" resultType="DeptVO">
			SELECT 	department_id
					,department_name
					,manager_id
					,location_id
			FROM departments
			WHERE department_id = #{departmentId}
		</select>
		
	<!-- 부서 등록 -->
		<insert id="insertDept" parameterType="DeptVO">
			<selectKey keyProperty="departmentId"
					   resultType="Integer"
					   order="BEFORE">
			SELECT NVL(MAX(department_id), 100) + 10
			FROM departments
			</selectKey>
			INSERT INTO departments
					(
						department_id
						,department_name
						,manager_id
						,location_id
					)
					VALUES
					(	
						#{departmentId}
						,#{departmentName}
						<choose>
							<when test="managerId == 0">
								,null
							</when>
							<otherwise>
								,#{managerId}
							</otherwise>
						</choose>
						<choose>
							<when test="locationId == 0">
								,null
							</when>
							<otherwise>
								,#{locationId}
							</otherwise>
						</choose>
					)
		</insert>
		
	<!-- 부서 수정 -->
		<update id="updateDept" parameterType="DeptVO">
			UPDATE departments
			SET	   
				department_name = #{dept.departmentName}
				<choose>
					<when test="dept.managerId == 0">
					,manager_id = null
					</when>
					<otherwise>
					,manager_id = #{dept.managerId}
					</otherwise>
				</choose>
				<choose>
					<when test="dept.locationId == 0">
					,location_id = null
					</when>
					<otherwise>
					,location_id = #{dept.locationId}
					</otherwise>
				</choose>
			WHERE department_id = #{deptId}
		</update>
		
	<!-- 부서 삭제 -->
		<delete id="deleteDept" parameterType="int">
			DELETE FROM departments
			WHERE department_id = #{departmentId}
		</delete>
</mapper>